<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Garis Bilangan üå∏‚ú®</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #E8D5F2 0%, #D4E4F7 50%, #E0C3FC 100%);
            background-attachment: fixed;
            font-family: 'Quicksand', sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Cute floating elements background */
        body::before {
            content: '‚ú® üíú üå∏ ‚≠ê üíô ü¶Ñ üåà ‚òÅÔ∏è';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            font-size: 2rem;
            opacity: 0.1;
            pointer-events: none;
            word-spacing: 3rem;
            line-height: 5rem;
            animation: float 20s infinite linear;
            z-index: 0;
        }

        @keyframes float {
            0% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
            100% {
                transform: translateY(0);
            }
        }

        .navbar {
            background: linear-gradient(135deg, #B794F4 0%, #9F7AEA 50%, #805AD5 100%);
            box-shadow: 0 8px 32px rgba(149, 117, 205, 0.4);
            padding: 1.2rem 2rem;
            border-radius: 0 0 30px 30px;
            backdrop-filter: blur(10px);
        }

        .navbar-brand {
            color: #ffffff !important;
            font-weight: 700;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .navbar-brand::before {
            content: '‚ú® ';
        }

        .navbar-brand::after {
            content: ' ‚ú®';
        }

        .navbar-brand:hover {
            transform: scale(1.05) rotate(-2deg);
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.3);
        }

        .nav-link {
            color: #ffffff !important;
            font-weight: 600;
            margin: 0 0.5rem;
            padding: 0.6rem 1.2rem !important;
            border-radius: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
        }

        .container {
            position: relative;
            z-index: 1;
        }

        .content {
            animation: slideInUp 0.6s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: #805AD5;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(128, 90, 213, 0.2);
            margin-bottom: 2rem !important;
            position: relative;
            display: inline-block;
        }

        h1::before {
            content: 'üåü';
            margin-right: 10px;
        }

        h1::after {
            content: 'üåü';
            margin-left: 10px;
        }

        .question-card {
            background: linear-gradient(135deg, #E9D8FD 0%, #D4E4F7 100%);
            border: 3px solid #C4B5D4;
            border-radius: 25px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(128, 90, 213, 0.2);
            text-align: center;
        }

        .question-text {
            font-size: 2.5rem;
            font-weight: 700;
            color: #6B46C1;
            margin-bottom: 1rem;
        }

        .instruction-text {
            color: #805AD5;
            font-size: 1rem;
            font-weight: 600;
        }

        .canvas-card {
            border: 4px solid #D4B5F0;
            border-radius: 30px;
            background: linear-gradient(135deg, #FFFFFF 0%, #FAF5FF 100%);
            box-shadow: 0 8px 32px rgba(128, 90, 213, 0.2);
            overflow: hidden;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .canvas-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(128, 90, 213, 0.3);
        }

        .card-body {
            padding: 2rem !important;
            background: linear-gradient(135deg, #FFFFFF 0%, #FAF5FF 50%, #E9D8FD 100%);
        }

        canvas {
            border-radius: 20px;
            cursor: grab;
            display: block;
            width: 100%;
        }

        canvas:active {
            cursor: grabbing;
        }

        .zoom-controls {
            text-align: center;
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .zoom-btn {
            background: linear-gradient(135deg, #9F7AEA 0%, #805AD5 100%);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 15px;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(128, 90, 213, 0.4);
        }

        .zoom-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(128, 90, 213, 0.6);
            background: linear-gradient(135deg, #B794F4 0%, #9F7AEA 100%);
        }

        .zoom-info {
            color: #805AD5;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .arrow-controls-card {
            background: linear-gradient(135deg, #FAF5FF 0%, #E9D8FD 100%);
            border: 3px solid #D4B5F0;
            border-radius: 25px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(128, 90, 213, 0.2);
        }

        .arrow-controls-card h3 {
            color: #6B46C1;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .arrow-section {
            background: white;
            border: 3px solid #D4B5F0;
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(128, 90, 213, 0.1);
            transition: all 0.3s ease;
        }

        .arrow-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(128, 90, 213, 0.15);
        }

        .arrow-section:last-child {
            margin-bottom: 0;
        }

        .arrow-title {
            font-weight: 700;
            color: #805AD5;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .arrow-color-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
            vertical-align: middle;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .arrow1-color {
            background: #10b981;
        }

        .arrow2-color {
            background: #f59e0b;
        }

        .form-label {
            font-size: 0.9rem;
            color: #6B46C1;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .number-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #FAF5FF 0%, #E9D8FD 100%);
            border: 2px solid #D4B5F0;
            border-radius: 15px;
            padding: 0.3rem;
        }

        .input-btn {
            background: linear-gradient(135deg, #9F7AEA 0%, #805AD5 100%);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 12px;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(128, 90, 213, 0.3);
            flex-shrink: 0;
        }

        .input-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(128, 90, 213, 0.5);
        }

        .number-input {
            flex: 1;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            color: #6B46C1;
            background: white;
            border: 2px solid #D4B5F0;
            border-radius: 10px;
            padding: 0.5rem;
            outline: none;
            transition: all 0.3s ease;
            min-width: 0;
        }

        .number-input:focus {
            border-color: #9F7AEA;
            box-shadow: 0 0 0 3px rgba(159, 122, 234, 0.2);
            transform: scale(1.05);
        }

        .btn-arrow-check {
            background: linear-gradient(135deg, #9F7AEA 0%, #805AD5 100%);
            border: none;
            color: white;
            font-weight: 700;
            padding: 0.6rem 1.5rem;
            border-radius: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(128, 90, 213, 0.4);
            width: 100%;
            margin-top: 1rem;
        }

        .btn-arrow-check:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(128, 90, 213, 0.6);
            background: linear-gradient(135deg, #B794F4 0%, #9F7AEA 100%);
        }

        .answer-section {
            text-align: center;
        }

        .answer-display {
            background: linear-gradient(135deg, #FAF5FF 0%, #E9D8FD 100%);
            border: 3px solid #D4B5F0;
            border-radius: 20px;
            padding: 1rem 2rem;
            font-size: 1.8rem;
            font-weight: 700;
            color: #6B46C1;
            min-width: 150px;
            display: inline-block;
            margin-bottom: 1.5rem;
            min-height: 60px;
            line-height: 60px;
            box-shadow: 0 4px 15px rgba(128, 90, 213, 0.2);
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            max-width: 500px;
            margin: 1.5rem auto;
        }

        .key-btn {
            background: linear-gradient(135deg, #B794F4 0%, #9F7AEA 100%);
            border: none;
            padding: 1rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(128, 90, 213, 0.3);
        }

        .key-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(128, 90, 213, 0.5);
            background: linear-gradient(135deg, #C4B5D4 0%, #B794F4 100%);
        }

        .control-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 1rem 2rem;
            font-weight: 700;
            border-radius: 25px;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-success:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .btn-danger:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .alert-success {
            background: linear-gradient(135deg, #E9D8FD 0%, #D4E4F7 100%);
            border: 3px solid #C4B5D4;
            border-radius: 25px;
            color: #805AD5;
            font-weight: 700;
            font-size: 1.3rem;
            box-shadow: 0 8px 25px rgba(128, 90, 213, 0.2);
            padding: 1.5rem;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .result-alert.updated {
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        @media (max-width: 768px) {
            .navbar-brand {
                font-size: 1.2rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .question-text {
                font-size: 2rem;
            }

            .keypad {
                grid-template-columns: repeat(4, 1fr);
            }

            .number-input {
                font-size: 1.1rem;
            }

            .input-btn {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .arrow-inputs {
                display: flex;
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Pembelajaran Bilangan Bulat</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" style="background: white; border-radius: 15px">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">‚ûï Penjumlahan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="pengurangan.html">‚ûñ Pengurangan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="Interaktif1.html">üß© Interaktif Penjumlahan dan Pengurangan</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container my-5 content">
        <div class="text-center">
            <h1>Interaktif Penjumlahan dan Pengurangan</h1>
            <!-- <p class="subtitle" style="color: #9F7AEA; font-size: 1.1rem; font-weight: 600;">Penjumlahan & Pengurangan</p> -->
        </div>
        
        <div class="question-card">
            <div class="question-text" id="question">3 + 2 = ?</div>
            <div class="instruction-text">
                Gerakkan mobil di garis bilangan untuk menyelesaikan soal! Geser canvas untuk melihat angka lain.
            </div>
        </div>
        
        <div class="card canvas-card mb-4">
            <div class="card-body p-0">
                <canvas id="numberLine" width="700" height="250"></canvas>
            </div>
        </div>
        
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="changeSpacing(-5)" title="Zoom Out">‚àí</button>
            <span class="zoom-info">Geser untuk melihat lebih banyak angka</span>
            <button class="zoom-btn" onclick="changeSpacing(5)" title="Zoom In">+</button>
        </div>
        
        <div class="arrow-controls-card">
            <h3>üöó Kontrol Mobil</h3>
            
            <div class="arrow-section">
                <div class="arrow-title">
                    üöó Mobil 1 <span class="arrow-color-indicator arrow1-color"></span>
                </div>
                <div class="row arrow-inputs g-3">
                    <div class="col-md-6">
                        <label class="form-label">Posisi Awal:</label>
                        <div class="number-input-wrapper">
                            <button class="input-btn" onclick="changeArrow(1, 'start', -1)">‚àí</button>
                            <input type="text" class="number-input" id="arrow1-start" value="0" 
                                   onchange="updateArrowFromInput(1, 'start')" 
                                   onkeypress="return allowNumberInput(event)">
                            <button class="input-btn" onclick="changeArrow(1, 'start', 1)">+</button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Jarak Tempuh:</label>
                        <div class="number-input-wrapper">
                            <button class="input-btn" onclick="changeArrow(1, 'length', -1)">‚àí</button>
                            <input type="text" class="number-input" id="arrow1-length" value="0" 
                                   onchange="updateArrowFromInput(1, 'length')" 
                                   onkeypress="return allowNumberInput(event)">
                            <button class="input-btn" onclick="changeArrow(1, 'length', 1)">+</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-arrow-check" onclick="checkArrow(1)">
                    üëÅÔ∏è Cek Posisi Mobil 1
                </button>
            </div>
            
            <div class="arrow-section">
                <div class="arrow-title">
                    üöô Mobil 2 <span class="arrow-color-indicator arrow2-color"></span>
                </div>
                <div class="row arrow-inputs g-3">
                    <div class="col-md-6">
                        <label class="form-label">Posisi Awal:</label>
                        <div class="number-input-wrapper">
                            <button class="input-btn" onclick="changeArrow(2, 'start', -1)">‚àí</button>
                            <input type="text" class="number-input" id="arrow2-start" value="0" 
                                   onchange="updateArrowFromInput(2, 'start')" 
                                   onkeypress="return allowNumberInput(event)">
                            <button class="input-btn" onclick="changeArrow(2, 'start', 1)">+</button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Jarak Tempuh:</label>
                        <div class="number-input-wrapper">
                            <button class="input-btn" onclick="changeArrow(2, 'length', -1)">‚àí</button>
                            <input type="text" class="number-input" id="arrow2-length" value="0" 
                                   onchange="updateArrowFromInput(2, 'length')" 
                                   onkeypress="return allowNumberInput(event)">
                            <button class="input-btn" onclick="changeArrow(2, 'length', 1)">+</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-arrow-check" onclick="checkArrow(2)">
                    üëÅÔ∏è Cek Posisi Mobil 2
                </button>
            </div>
        </div>
        
        <div class="answer-section">
            <div class="answer-display" id="answerDisplay">_</div>
            
            <div class="keypad">
                <button class="key-btn" onclick="addDigit('7')">7</button>
                <button class="key-btn" onclick="addDigit('8')">8</button>
                <button class="key-btn" onclick="addDigit('9')">9</button>
                <button class="key-btn" onclick="addDigit('4')">4</button>
                <button class="key-btn" onclick="addDigit('5')">5</button>
                <button class="key-btn" onclick="addDigit('6')">6</button>
                <button class="key-btn" onclick="addDigit('1')">1</button>
                <button class="key-btn" onclick="addDigit('2')">2</button>
                <button class="key-btn" onclick="addDigit('3')">3</button>
                <button class="key-btn" onclick="addDigit('-')">‚àí</button>
                <button class="key-btn" onclick="addDigit('0')">0</button>
                <button class="key-btn" onclick="clearAnswer()">‚å´</button>
            </div>
            
            <div class="control-buttons">
                <button class="btn btn-success" onclick="checkAnswer()">
                    ‚úì Periksa Jawaban
                </button>
                <button class="btn btn-danger" onclick="resetArrows()">
                    ‚Ü∫ Reset Mobil
                </button>
                <button class="btn btn-warning" onclick="newQuestion()">
                    üîÑ Soal Baru
                </button>
            </div>
            
            <div id="hasil" class="alert alert-success text-center result-alert" role="alert" style="display: none;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const canvas = document.getElementById("numberLine");
      const ctx = canvas.getContext("2d");
      const canvasWrapper = canvas.parentElement;

      let currentQuestion = {};
      let userAnswer = "";
      let arrows = {
        1: { start: 0, length: 0 },
        2: { start: 0, length: 0 },
      };

      let spacing = 50;
      let offsetX = 0;
      let isDragging = false;
      let dragStartX = 0;
      let dragStartOffset = 0;

      function initCanvas() {
        const container = canvas.parentElement;
        canvas.width = container.offsetWidth - 40;
        canvas.height = 250;
      }

      window.addEventListener('resize', () => {
        initCanvas();
        drawNumberLine();
      });

      function generateQuestion() {
        const types = [
          {
            type: "pos+pos",
            a: () => Math.floor(Math.random() * 8) + 1,
            b: () => Math.floor(Math.random() * 8) + 1,
          },
          {
            type: "neg+pos",
            a: () => -Math.floor(Math.random() * 8) - 1,
            b: () => Math.floor(Math.random() * 8) + 1,
          },
          {
            type: "pos-pos",
            a: () => Math.floor(Math.random() * 8) + 1,
            b: () => Math.floor(Math.random() * 8) + 1,
            op: "-",
          },
          {
            type: "neg-pos",
            a: () => -Math.floor(Math.random() * 5) - 1,
            b: () => Math.floor(Math.random() * 5) + 1,
            op: "-",
          },
        ];

        const selected = types[Math.floor(Math.random() * types.length)];
        const a = selected.a();
        const b = selected.b();
        const op = selected.op || "+";
        const answer = op === "+" ? a + b : a - b;

        return { a, b, op, answer };
      }

      function newQuestion() {
        currentQuestion = generateQuestion();
        document.getElementById(
          "question"
        ).textContent = `${currentQuestion.a} ${currentQuestion.op} ${currentQuestion.b} = ?`;
        userAnswer = "";
        document.getElementById("answerDisplay").textContent = "_";
        document.getElementById("hasil").style.display = "none";

        resetArrows();
        offsetX = 0; // Reset canvas position to center on 0
        drawNumberLine();
      }

      function resetArrows() {
        arrows[1] = { start: 0, length: 0 };
        arrows[2] = { start: 0, length: 0 };
        offsetX = 0; // Reset canvas position to center on 0
        
        // Reset animation state
        if (animationFrameId) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
        animationState = {
          car1: { animating: false, progress: 0, currentX: 0, targetX: 0, startX: 0 },
          car2: { animating: false, progress: 0, currentX: 0, targetX: 0, startX: 0 }
        };
        
        updateArrowDisplays();
        drawNumberLine();
      }

      function changeArrow(arrowNum, property, delta) {
        if (property === "start") {
          arrows[arrowNum].start += delta;
        } else if (property === "length") {
          arrows[arrowNum].length += delta;
        }
        updateArrowDisplays();
        
        // Trigger animation for this car
        if (animationFrameId) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
        animationState[`car${arrowNum}`] = { animating: false, progress: 0, currentX: 0, targetX: 0, startX: 0 };
        startCarAnimation(arrowNum);
        
        // Also redraw the other car statically if it exists
        if (arrowNum === 1 && arrows[2].length !== 0) {
          animationState.car2 = { animating: false, progress: 1, currentX: 0, targetX: 0, startX: 0 };
        } else if (arrowNum === 2 && arrows[1].length !== 0) {
          animationState.car1 = { animating: false, progress: 1, currentX: 0, targetX: 0, startX: 0 };
        }
        
        if (arrows[arrowNum].length === 0) {
          drawNumberLine();
        }
      }

      function allowNumberInput(event) {
        const char = event.key;
        const input = event.target;
        const currentValue = input.value;
        const selectionStart = input.selectionStart;

        // Allow minus sign at the beginning
        if (char === "-") {
          // Only allow if cursor is at position 0 and there's no minus sign yet
          if (selectionStart === 0 && !currentValue.startsWith("-")) {
            return true;
          }
          // Also allow if the entire text is selected (will be replaced)
          if (input.selectionStart === 0 && input.selectionEnd === currentValue.length) {
            return true;
          }
          event.preventDefault();
          return false;
        }
        if (char >= "0" && char <= "9") {
          return true;
        }
        if (char === "Enter") {
          event.target.blur();
          return false;
        }

        event.preventDefault();
        return false;
      }

      function updateArrowFromInput(arrowNum, property) {
        const inputId = `arrow${arrowNum}-${property}`;
        const input = document.getElementById(inputId);
        const value = input.value.trim();

        if (value === "" || value === "-") {
          arrows[arrowNum][property] = 0;
          input.value = "0";
        } else {
          const num = parseInt(value);
          if (!isNaN(num)) {
            arrows[arrowNum][property] = num;
            input.value = num.toString();
          } else {
            input.value = arrows[arrowNum][property].toString();
          }
        }

        // Trigger animation for this car
        if (animationFrameId) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
        animationState[`car${arrowNum}`] = { animating: false, progress: 0, currentX: 0, targetX: 0, startX: 0 };
        startCarAnimation(arrowNum);
        
        if (arrows[arrowNum].length === 0) {
          drawNumberLine();
        }
      }

      function checkArrow(arrowNum) {
        const arrow = arrows[arrowNum];
        highlightArrow(arrowNum);
      }

      function highlightArrow(arrowNum) {
        const originalColor1 = "#10B981";
        const originalColor2 = "#F59E0B";
        const highlightColor = "#FF00FF";

        let flashCount = 0;
        const flashInterval = setInterval(() => {
          if (flashCount >= 6) {
            clearInterval(flashInterval);
            drawNumberLine();
            return;
          }

          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawNumberLineBase();

          if (arrows[1].length !== 0) {
            const color1 =
              arrowNum === 1 && flashCount % 2 === 0
                ? highlightColor
                : originalColor1;
            drawCarPath(arrows[1], color1, canvas.height / 2 - 50, 1);
          }

          if (arrows[2].length !== 0) {
            const color2 =
              arrowNum === 2 && flashCount % 2 === 0
                ? highlightColor
                : originalColor2;
            drawCarPath(arrows[2], color2, canvas.height / 2 - 80, 2);
          }

          flashCount++;
        }, 200);
      }

      function updateArrowDisplays() {
        document.getElementById("arrow1-start").value = arrows[1].start;
        document.getElementById("arrow1-length").value = arrows[1].length;
        document.getElementById("arrow2-start").value = arrows[2].start;
        document.getElementById("arrow2-length").value = arrows[2].length;
      }

      function changeSpacing(delta) {
        spacing = Math.max(20, Math.min(80, spacing + delta));
        drawNumberLine();
      }

      function drawNumberLineBase() {
        const centerY = canvas.height / 2;
        const centerX = canvas.width / 2 + offsetX;

        const visibleRange = Math.ceil(canvas.width / spacing / 2) + 5;
        const offsetNumbers = Math.round(-offsetX / spacing);
        const start = -visibleRange + offsetNumbers;
        const end = visibleRange + offsetNumbers;

        // Draw gradient line
        const gradient = ctx.createLinearGradient(0, centerY, canvas.width, centerY);
        gradient.addColorStop(0, '#B794F4');
        gradient.addColorStop(0.5, '#9F7AEA');
        gradient.addColorStop(1, '#B794F4');
        
        ctx.strokeStyle = gradient;
        ctx.lineWidth = 4;
        ctx.lineCap = 'round';
        ctx.shadowColor = "rgba(159, 122, 234, 0.3)";
        ctx.shadowBlur = 8;
        ctx.beginPath();
        ctx.moveTo(0, centerY);
        ctx.lineTo(canvas.width, centerY);
        ctx.stroke();
        ctx.shadowBlur = 0;

        // Draw ticks and numbers
        ctx.font = 'bold 14px Quicksand';
        ctx.fillStyle = '#9F7AEA';
        ctx.textAlign = 'center';

        for (let i = start; i <= end; i++) {
          const x = centerX + i * spacing;

          if (x >= 0 && x <= canvas.width) {
            if (i === 0) {
              ctx.strokeStyle = '#9F7AEA';
              ctx.lineWidth = 4;
              ctx.beginPath();
              ctx.moveTo(x, centerY - 15);
              ctx.lineTo(x, centerY + 15);
              ctx.stroke();
              ctx.fillStyle = '#6B46C1';
              ctx.font = 'bold 18px Quicksand';
              ctx.fillText('0', x, centerY + 35);
              ctx.font = 'bold 14px Quicksand';
            } else {
              ctx.strokeStyle = '#D4B5F0';
              ctx.lineWidth = 2;
              ctx.beginPath();
              ctx.moveTo(x, centerY - 10);
              ctx.lineTo(x, centerY + 10);
              ctx.stroke();
              ctx.fillStyle = '#9F7AEA';
              ctx.fillText(i.toString(), x, centerY + 35);
            }
          }
        }

        // Draw arrowheads at ends
        drawArrowhead(canvas.width - 10, centerY, "right", '#9F7AEA');
        drawArrowhead(10, centerY, "left", '#9F7AEA');
      }

      function drawNumberLine() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawNumberLineBase();

        if (arrows[1].length !== 0) {
          drawCarPath(arrows[1], "#10B981", canvas.height / 2 - 50, 1);
        }

        if (arrows[2].length !== 0) {
          drawCarPath(arrows[2], "#F59E0B", canvas.height / 2 - 80, 2);
        }
      }

      function drawArrowhead(x, y, direction, color) {
        ctx.fillStyle = color;
        ctx.shadowColor = "rgba(159, 122, 234, 0.3)";
        ctx.shadowBlur = 5;
        ctx.beginPath();
        ctx.moveTo(x, y);
        if (direction === "right") {
          ctx.lineTo(x - 10, y - 8);
          ctx.lineTo(x - 10, y + 8);
        } else {
          ctx.lineTo(x + 10, y - 8);
          ctx.lineTo(x + 10, y + 8);
        }
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      function drawCar(x, y, direction, color, isSilhouette = false) {
        ctx.save();
        ctx.translate(x, y);
        
        // Flip car based on direction
        if (direction === "left") {
          ctx.scale(-1, 1);
        }
        
        // Set global alpha for silhouette
        if (isSilhouette) {
          ctx.globalAlpha = 0.95;
        }
        
        // Car body shadow (reduced for silhouette)
        if (!isSilhouette) {
          ctx.shadowColor = "rgba(0, 0, 0, 0.3)";
          ctx.shadowBlur = 8;
          ctx.shadowOffsetY = 3;
        }
        
        // Car body (main)
        ctx.fillStyle = isSilhouette ? 'rgba(107, 70, 193, 0.5)' : color;
        ctx.beginPath();
        ctx.roundRect(-25, -12, 50, 20, 5);
        ctx.fill();
        
        // Car roof
        ctx.beginPath();
        ctx.roundRect(-15, -22, 28, 12, 4);
        ctx.fill();
        
        // Reset shadow for details
        ctx.shadowBlur = 0;
        ctx.shadowOffsetY = 0;
        
        // Windows
        ctx.fillStyle = isSilhouette ? "rgba(135, 206, 250, 0.4)" : "rgba(135, 206, 250, 0.9)";
        ctx.beginPath();
        ctx.roundRect(-12, -20, 11, 8, 2);
        ctx.fill();
        ctx.beginPath();
        ctx.roundRect(1, -20, 11, 8, 2);
        ctx.fill();
        
        // Headlight and Taillight
        if (!isSilhouette) {
          // Headlight yellow at front (x=22), taillight red at back (x=-22)
          ctx.fillStyle = "#FFD700";
          ctx.beginPath();
          ctx.ellipse(22, -2, 4, 3, 0, 0, Math.PI * 2);
          ctx.fill();
          
          ctx.fillStyle = "#FF4444";
          ctx.beginPath();
          ctx.ellipse(-22, -2, 3, 3, 0, 0, Math.PI * 2);
          ctx.fill();
        } else {
          // Silhouette lights (faded)
          ctx.fillStyle = "rgba(255, 215, 0, 0.3)";
          ctx.beginPath();
          ctx.ellipse(22, -2, 4, 3, 0, 0, Math.PI * 2);
          ctx.fill();
          
          ctx.fillStyle = "rgba(255, 68, 68, 0.3)";
          ctx.beginPath();
          ctx.ellipse(-22, -2, 3, 3, 0, 0, Math.PI * 2);
          ctx.fill();
        }
        
        // Wheels
        ctx.fillStyle = isSilhouette ? "rgba(51, 51, 51, 0.4)" : "#333";
        ctx.beginPath();
        ctx.arc(-15, 10, 7, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(15, 10, 7, 0, Math.PI * 2);
        ctx.fill();
        
        // Wheel caps
        ctx.fillStyle = isSilhouette ? "rgba(136, 136, 136, 0.4)" : "#888";
        ctx.beginPath();
        ctx.arc(-15, 10, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(15, 10, 3, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.restore();
      }

      function drawTrail(startX, endX, y, color) {
        const gradient = ctx.createLinearGradient(startX, y, endX, y);
        if (startX < endX) {
          gradient.addColorStop(0, "rgba(255,255,255,0)");
          gradient.addColorStop(0.3, color + "40");
          gradient.addColorStop(1, color + "90");
        } else {
          gradient.addColorStop(0, color + "90");
          gradient.addColorStop(0.7, color + "40");
          gradient.addColorStop(1, "rgba(255,255,255,0)");
        }
        
        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.roundRect(Math.min(startX, endX), y - 4, Math.abs(endX - startX), 8, 4);
        ctx.fill();
        
        // Tire marks
        ctx.strokeStyle = color + "60";
        ctx.lineWidth = 2;
        ctx.setLineDash([8, 6]);
        ctx.beginPath();
        ctx.moveTo(startX, y + 3);
        ctx.lineTo(endX, y + 3);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(startX, y - 3);
        ctx.lineTo(endX, y - 3);
        ctx.stroke();
        ctx.setLineDash([]);
      }

      function drawDustParticles(x, y, direction, progress) {
        const numParticles = 5;
        for (let i = 0; i < numParticles; i++) {
          const dustOffsetX = direction === "right" ? -20 - Math.random() * 30 : 20 + Math.random() * 30;
          const dustOffsetY = (Math.random() - 0.5) * 20;
          const size = 2 + Math.random() * 4;
          const alpha = 0.3 + Math.random() * 0.3;
          
          ctx.fillStyle = `rgba(200, 180, 160, ${alpha * (1 - (progress % 0.3) / 0.3)})`;
          ctx.beginPath();
          ctx.arc(x + dustOffsetX, y + dustOffsetY, size, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      function drawResultMarker(x, y) {
        ctx.shadowColor = "rgba(107, 70, 193, 0.5)";
        ctx.shadowBlur = 15;
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, 2 * Math.PI);
        ctx.fillStyle = '#6B46C1';
        ctx.fill();
        ctx.shadowBlur = 0;
        
        // Inner highlight
        ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
        ctx.beginPath();
        ctx.arc(x - 3, y - 3, 4, 0, Math.PI * 2);
        ctx.fill();
      }

      // Animation state
      let animationFrameId = null;
      let animationState = {
        car1: { animating: false, progress: 0, currentX: 0, targetX: 0, startX: 0 },
        car2: { animating: false, progress: 0, currentX: 0, targetX: 0, startX: 0 }
      };

      function startCarAnimation(carNum) {
        const carData = arrows[carNum];
        if (carData.length === 0) return;
        
        const centerX = canvas.width / 2 + offsetX;
        const startX = centerX + carData.start * spacing;
        const endX = centerX + (carData.start + carData.length) * spacing;
        
        animationState[`car${carNum}`] = {
          animating: true,
          progress: 0,
          currentX: startX,
          targetX: endX,
          startX: startX
        };
        
        if (!animationFrameId) {
          animationFrameId = requestAnimationFrame(animateAllCars);
        }
      }

      function animateAllCars(timestamp) {
        const animationDuration = 800;
        let stillAnimating = false;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawNumberLineBase();
        
        // Draw car 1
        if (arrows[1].length !== 0) {
          const state1 = animationState.car1;
          const centerX = canvas.width / 2 + offsetX;
          const startX1 = centerX + arrows[1].start * spacing;
          const endX1 = centerX + (arrows[1].start + arrows[1].length) * spacing;
          
          if (state1.animating) {
            state1.progress += 16 / animationDuration;
            if (state1.progress >= 1) {
              state1.progress = 1;
              state1.animating = false;
            }
            state1.currentX = startX1 + (endX1 - startX1) * Math.min(state1.progress, 1);
            stillAnimating = stillAnimating || state1.animating;
            
            // Draw trail up to current position
            drawTrail(startX1, state1.currentX, canvas.height / 2 - 50, "#10B981");
            
            // Draw dust particles
            if (state1.progress < 1) {
              const dir1 = arrows[1].length > 0 ? "right" : "left";
              drawDustParticles(state1.currentX, canvas.height / 2 - 50, dir1, state1.progress);
            }
            
            // Draw starting point
            ctx.fillStyle = "#10B981";
            ctx.shadowColor = "rgba(16, 185, 129, 0.4)";
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.arc(startX1, canvas.height / 2 - 50, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Draw car at current position
            const carDir1 = arrows[1].length > 0 ? "right" : "left";
            drawCar(state1.currentX, canvas.height / 2 - 55, carDir1, '#6B46C1');
            
            // Draw label
            const midX1 = (startX1 + state1.currentX) / 2;
            const labelText1 = arrows[1].length > 0 ? `+${arrows[1].length}` : `${arrows[1].length}`;
            ctx.font = "bold 16px Quicksand";
            const textWidth1 = ctx.measureText(labelText1).width;
            ctx.fillStyle = 'white';
            ctx.strokeStyle = "#10B981";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.roundRect(midX1 - textWidth1/2 - 10, canvas.height / 2 - 25, textWidth1 + 20, 28, 14);
            ctx.fill();
            ctx.stroke();
            ctx.fillStyle = "#10B981";
            ctx.fillText(labelText1, midX1, canvas.height / 2 - 7);
          } else {
            // Static drawing when not animating
            drawCarPath(arrows[1], "#10B981", canvas.height / 2 - 50, 1);
          }
        }
        
        // Draw car 2
        if (arrows[2].length !== 0) {
          const state2 = animationState.car2;
          const centerX = canvas.width / 2 + offsetX;
          const startX2 = centerX + arrows[2].start * spacing;
          const endX2 = centerX + (arrows[2].start + arrows[2].length) * spacing;
          
          if (state2.animating) {
            state2.progress += 16 / animationDuration;
            if (state2.progress >= 1) {
              state2.progress = 1;
              state2.animating = false;
            }
            state2.currentX = startX2 + (endX2 - startX2) * Math.min(state2.progress, 1);
            stillAnimating = stillAnimating || state2.animating;
            
            // Draw trail up to current position
            drawTrail(startX2, state2.currentX, canvas.height / 2 - 80, "#F59E0B");
            
            // Draw dust particles
            if (state2.progress < 1) {
              const actualDir2 = arrows[2].length > 0 ? "right" : "left";
              drawDustParticles(state2.currentX, canvas.height / 2 - 80, actualDir2, state2.progress);
            }
            
            // Draw starting point
            ctx.fillStyle = "#F59E0B";
            ctx.shadowColor = "rgba(245, 158, 11, 0.4)";
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.arc(startX2, canvas.height / 2 - 80, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Draw car at current position
            const isSubtraction = currentQuestion.op === "-";
            let carDir2;
            if (isSubtraction) {
              carDir2 = "left";
            } else {
              carDir2 = arrows[2].length > 0 ? "right" : "left";
            }
            drawCar(state2.currentX, canvas.height / 2 - 85, carDir2, '#6B46C1');
            
            // Draw label
            const midX2 = (startX2 + state2.currentX) / 2;
            const labelText2 = arrows[2].length > 0 ? `+${arrows[2].length}` : `${arrows[2].length}`;
            ctx.font = "bold 16px Quicksand";
            const textWidth2 = ctx.measureText(labelText2).width;
            ctx.fillStyle = 'white';
            ctx.strokeStyle = "#F59E0B";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.roundRect(midX2 - textWidth2/2 - 10, canvas.height / 2 - 55, textWidth2 + 20, 28, 14);
            ctx.fill();
            ctx.stroke();
            ctx.fillStyle = "#F59E0B";
            ctx.fillText(labelText2, midX2, canvas.height / 2 - 37);
          } else {
            // Static drawing when not animating
            drawCarPath(arrows[2], "#F59E0B", canvas.height / 2 - 80, 2);
          }
        }
        
        if (stillAnimating) {
          animationFrameId = requestAnimationFrame(animateAllCars);
        } else {
          animationFrameId = null;
          // Draw result marker at final position if both cars done
          if (arrows[1].length !== 0 && arrows[2].length !== 0) {
            const centerX = canvas.width / 2 + offsetX;
            const resultPos = arrows[2].start + arrows[2].length;
            const resultX = centerX + resultPos * spacing;
            drawResultMarker(resultX, canvas.height / 2);
          }
        }
      }

      function drawCarPath(carData, color, yPos, carNum) {
        const centerX = canvas.width / 2 + offsetX;
        const startX = centerX + carData.start * spacing;
        const endX = centerX + (carData.start + carData.length) * spacing;

        // Draw trail
        if (carData.length !== 0) {
          drawTrail(startX, endX, yPos, color);
        }

        // Draw starting point marker
        ctx.fillStyle = color;
        ctx.shadowColor = color === "#10B981" ? "rgba(16, 185, 129, 0.4)" : "rgba(245, 158, 11, 0.4)";
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.arc(startX, yPos, 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;

        // Draw car at the end position
        if (carData.length !== 0) {
          let carDirection;
          
          // Determine car direction based on car number and operation type
          if (carNum === 1) {
            // Car 1 (first number): direction based on movement direction
            carDirection = carData.length > 0 ? "right" : "left";
          } else {
            // Car 2 (second number): depends on operation type
            const isSubtraction = currentQuestion.op === "-";
            
            if (isSubtraction) {
              // PENGURANGAN: mobil menghadap kiri
              carDirection = "left";
            } else {
              // PENJUMLAHAN: mobil menghadap sesuai arah pergerakan
              carDirection = carData.length > 0 ? "right" : "left";
            }
          }
          
          drawCar(endX, yPos - 5, carDirection, '#6B46C1');
        }

        // Draw label for movement distance
        if (carData.length !== 0) {
          ctx.fillStyle = color;
          ctx.font = "bold 16px Quicksand";
          const midX = (startX + endX) / 2;
          const labelText =
            carData.length > 0 ? `+${carData.length}` : `${carData.length}`;
          
          const textWidth = ctx.measureText(labelText).width;
          ctx.fillStyle = 'white';
          ctx.strokeStyle = color;
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.roundRect(midX - textWidth/2 - 10, yPos + 25, textWidth + 20, 28, 14);
          ctx.fill();
          ctx.stroke();
          
          ctx.fillStyle = color;
          ctx.fillText(labelText, midX, yPos + 43);
        }
      }

      function addDigit(digit) {
        if (digit === "-" && userAnswer === "") {
          userAnswer = "-";
        } else if (digit !== "-") {
          userAnswer += digit;
        }
        document.getElementById("answerDisplay").textContent =
          userAnswer || "_";
      }

      function clearAnswer() {
        if (userAnswer.length > 0) {
          userAnswer = userAnswer.slice(0, -1);
          document.getElementById("answerDisplay").textContent =
            userAnswer || "_";
        }
      }

      function checkAnswer() {
        const hasilDiv = document.getElementById("hasil");
        const answerBox = document.getElementById("answerDisplay");

        if (userAnswer === "") {
          hasilDiv.textContent = "Masukkan jawaban dulu ya! üòä";
          hasilDiv.className = "alert alert-success text-center result-alert";
          hasilDiv.style.display = "block";
          return;
        }

        const userNum = parseInt(userAnswer);

        if (userNum === currentQuestion.answer) {
          hasilDiv.textContent = `Hebat! Jawabanmu benar üéâ ${currentQuestion.a} ${currentQuestion.op} ${currentQuestion.b} = ${currentQuestion.answer}`;
          hasilDiv.className = "alert alert-success text-center result-alert updated";
          hasilDiv.style.display = "block";
          answerBox.style.background = "linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%)";
          answerBox.style.borderColor = "#10B981";
          
          setTimeout(() => {
            hasilDiv.classList.remove("updated");
          }, 600);
        } else {
          hasilDiv.textContent = `Coba lagi ya üòÖ Jawaban yang benar adalah ${currentQuestion.answer}`;
          hasilDiv.className = "alert alert-success text-center result-alert";
          hasilDiv.style.display = "block";
          answerBox.style.background = "linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%)";
          answerBox.style.borderColor = "#EF4444";

          setTimeout(() => {
            answerBox.style.background = "linear-gradient(135deg, #FAF5FF 0%, #E9D8FD 100%)";
            answerBox.style.borderColor = "#D4B5F0";
          }, 2000);
        }
      }

      initCanvas();
      newQuestion();

      // Mouse drag events
      canvas.addEventListener('mousedown', (e) => {
        isDragging = true;
        dragStartX = e.clientX;
        dragStartOffset = offsetX;
        canvas.style.cursor = 'grabbing';
      });

      canvas.addEventListener('mousemove', (e) => {
        if (isDragging) {
          const deltaX = e.clientX - dragStartX;
          offsetX = dragStartOffset + deltaX;
          drawNumberLine();
        }
      });

      canvas.addEventListener('mouseup', () => {
        isDragging = false;
        canvas.style.cursor = 'grab';
      });

      canvas.addEventListener('mouseleave', () => {
        isDragging = false;
        canvas.style.cursor = 'grab';
      });

      // Touch events for mobile
      canvas.addEventListener('touchstart', (e) => {
        isDragging = true;
        dragStartX = e.touches[0].clientX;
        dragStartOffset = offsetX;
      });

      canvas.addEventListener('touchmove', (e) => {
        if (isDragging) {
          e.preventDefault();
          const deltaX = e.touches[0].clientX - dragStartX;
          offsetX = dragStartOffset + deltaX;
          drawNumberLine();
        }
      });

      canvas.addEventListener('touchend', () => {
        isDragging = false;
      });
    </script>
</body>
</html>